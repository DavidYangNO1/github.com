<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[I'm DavidYang]]></title>
  <link href="http://www.davidyanggo.me/atom.xml" rel="self"/>
  <link href="http://www.davidyanggo.me/"/>
  <updated>2015-11-21T12:08:34+08:00</updated>
  <id>http://www.davidyanggo.me/</id>
  <author>
    <name><![CDATA[David Yang]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[xcode 版本管理]]></title>
    <link href="http://www.davidyanggo.me/blog/2015/11/18/xcode-ban-ben-guan-li/"/>
    <updated>2015-11-18T00:35:00+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2015/11/18/xcode-ban-ben-guan-li</id>
    <content type="html"><![CDATA[<p>xcode agvtool 版本管理命令</p>

<!--more-->


<p>xcode agvtool 版本管理命令
agvtool 主要是管理项目的版本工具
xcode 项目工程文件project.pbxproj包含项目版本CURRENT_PROJECT_VERSION，agvtool工具运行的时候会查看 project.pbxproj里面的CURRENT_PROJECT_VERSION是否存在，如果存在然后更新build版本号，不存在在Xcode建立CURRENT_PROJECT_VERSION再去使用agvtool</p>

<p>主要是通过命令行来修改版本号，项目版本号</p>

<p>1：修改版本号
agvtool new-marketing-version &lt;your_specific_version>
etc. agvtool new-marketing-version 2.0
上面命令主要会更新info.plist 里面的CFBundleShortVersionString 版本号位2.0</p>

<p>2：修改build 版本号</p>

<p>  2.1 自动增加build 版本号
  agvtool next-version -all
  上面命令会自动把当前版本增加到大于当前的整数版本号
  2.2 制定特定的版本号
  agvtool new-version -all &lt;your_specific_version>
  etc. agvtool new-version -all 2.6.9</p>

<p>3：版本号查看
  3.1 查看当前版本
  agvtool what-marketing-version</p>

<p>  3.2 查看当前构建版本
  agvtool what-version</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[android cmd install]]></title>
    <link href="http://www.davidyanggo.me/blog/2015/11/07/android-cmd-install/"/>
    <updated>2015-11-07T00:31:00+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2015/11/07/android-cmd-install</id>
    <content type="html"><![CDATA[<p>android 命令行安装打包</p>

<!--more-->


<p>1: CMD  切换到Android 项目root 目录</p>

<p>2：使用Gradle 编译项目，使用gradle 脚本执行assembleDebug 编译项目</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">gradlew</span>
</span><span class='line'><span class="p">.</span><span class="o">/</span><span class="n">gradlew</span> <span class="n">assembleDebug</span>
</span></code></pre></td></tr></table></div></figure>


<p>
3：项目root 目录下的build 生成 {app name}.apk</p>

<p>4: 安装apk 到设备</p>

<p>adb install bin/{app name}.apk</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ios9 网络问题 schema白名单]]></title>
    <link href="http://www.davidyanggo.me/blog/2015/09/08/ios9-wang-luo-wen-ti-schema/"/>
    <updated>2015-09-08T12:41:00+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2015/09/08/ios9-wang-luo-wen-ti-schema</id>
    <content type="html"><![CDATA[<p>ios 9 适配两个明显的问题</p>

<!--more-->


<p>1：网络问题
   iOS9 网络协议开始从http转换到https. 所以你的app 如果服务器不支持tls2估计很多网络模块打不开什么
   有两中解决方案：1) 服务器升级支持https</p>

<pre><code>             2) 或者在plist添加申明，不适用默认的https,转到http协议，具体做法如下
             &lt;img src="http://www.davidyanggo.me/images/schema.png"&gt; 
</code></pre>

<p>2：schema 白名单问题，白名单，IOS9 需要把你要打开的schema 添加到info.plist 白名单里面去
参考如下：
<key>LSApplicationQueriesSchemes</key>
<array></p>

<pre><code>&lt;string&gt;twitter&lt;/string&gt;
&lt;string&gt;whatsapp&lt;/string&gt;
</code></pre>

<p></array></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mvc vs mvvm]]></title>
    <link href="http://www.davidyanggo.me/blog/2015/05/05/mvc-vs-mvvm/"/>
    <updated>2015-05-05T00:39:00+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2015/05/05/mvc-vs-mvvm</id>
    <content type="html"><![CDATA[<p>前段时间，结合公司的项目实际情况，做了MVC vs MVVM的框架比较，技术分享</p>

<!--more-->


<p>1）MVC FLow</p>

<pre><code>1:MVC是最初的UI设计模式，1970年的时候就出现了，最早出现在Smalltalk语言中，
2:介绍MVC 这种模式
3:上图这种Model-View-Controller之间的环状关系
</code></pre>

<p><img src="http://www.davidyanggo.me/images/mvc1.png"></p>

<p>2） MVC Case</p>

<pre><code>1：流程图介绍
2：Massive View Controller
3：目前的项目
</code></pre>

<p><img src="http://www.davidyanggo.me/images/mvc2.png"></p>

<p>3）MVC劣势</p>

<pre><code>1:Massive Controller，关联了View,Model,双向环状关系，
  不利于后续维护，特别是多人协作时候，一个Controller文件动辄就几千行代码

2:关系复杂，后续UI风格更新，在几千行代码修改什么感觉？一不留神改了model，或者controller的东西，容易产生bug

3:单元测试不方便， 改动的范围不能够控制在一个较小的范围。

4:不能够复用。
  比如iphone版本，ipad版本，不管UI这么变，业务逻辑是基本相同的，Controller与model，view这种强耦合关系不方便复用
</code></pre>

<p><img src="http://www.davidyanggo.me/images/mvc3.png"></p>

<p>4）mvvm 本质</p>

<pre><code>1:view 引用了View Model,单向的
2:ViewModel 引用了Model,单向的
</code></pre>

<p><img src="http://www.davidyanggo.me/images/mvvm1.png"></p>

<p>5) mvvm 流程图讲解</p>

<pre><code>1：MVVM模式依赖于数据绑定，它是一个框架级别的特性，用于自动连接对象属性和UI控件
2：IOS没有数据绑定框架，可以通过ReactiveCocoa来实现数据绑定功能
3：ReactiveCocoa开源的项目，目的就是定义一个统一的事件处理接口，这样它们可以非常简单地进行链接、过滤和组合。
   ReactiveCocoa结合了一些编程模式：
   函数式编程：利用高阶函数，即将函数作为其它函数的参数。
   响应式编程：关注于数据流及变化的传播
</code></pre>

<p><img src="http://www.davidyanggo.me/images/mvvm2.png"></p>

<p>6)mvvm 优势</p>

<pre><code>1：低耦合
   视图（View）可以独立于Model变化和修改，一个ViewModel可以绑定到不同的"View"上，当View变化的时候Model可以不变，当Model变化的时候View也可以不变。
2：可重用性
   对于iphoen,ipad不同版本，不同的只是UI, 视图逻辑放到ViewModel,可以达到视图逻辑重用
3：独立开发
   开发人员可以专注于ViewModel，model的开发，UI开发人员通过Controller,View,xib,storyboad专注页面，模块业务清晰
4：单元测试
   ViewModel 独立于UI很方便做单元测试，不会像MVC里面的Controle一样做测试那么别扭
</code></pre>

<p><img src="http://www.davidyanggo.me/images/mvvm3.png"></p>

<p>7）总结：从产品项目开发的经验来看，显然mvvm比起mvc这种模式优势很明显，推荐大家引入到实际项目中去，主要是思想上</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ComponentKit 最佳实践，注意细节]]></title>
    <link href="http://www.davidyanggo.me/blog/2015/04/02/componentkit-zui-jia-shi-jian-%2Czhu-yi-xi-jie/"/>
    <updated>2015-04-02T21:54:23+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2015/04/02/componentkit-zui-jia-shi-jian-,zhu-yi-xi-jie</id>
    <content type="html"><![CDATA[<p>ComponentKit  最佳实践,开发中需要注意的地方</p>

<!--more-->


<p>1:代码行不超过300行：</p>

<p>  代码行多维护起来就不方便，组件化的代码文件快总共最好不要超过300行，如果超过，最佳的处理方式是拆分单独的CKCompositeComponent</p>

<p>2：避免直接设置组件宽度100%，不利于组件重用。好的处理方式是通过父组件来制定宽度
   比如如果父组件是CKStackLayoutComponent,使用CKStackLayoutAlignItemsStretch 拉伸填充</p>

<p>3: 通过+new创建一个组件，nil检查
   +new 创建的对象，又可以为空，比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'>   <span class="err">@</span><span class="n">implementation</span> <span class="n">MyComponent</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>            <span class="n">NSString</span> <span class="o">*</span><span class="n">_name</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="o">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nl">newWithName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">name</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>            <span class="n">MyComponent</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">newWithComponent:</span><span class="p">...];</span>
</span><span class='line'>            <span class="n">c</span><span class="o">-&gt;</span><span class="n">_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="n">copy</span><span class="p">];</span> <span class="c1">// Crashes if c is nil</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<pre><code> 正确的做法是检查对象c是否为空
</code></pre>

<p>4：代码块避免过多的分支，分支过多，可读性不好
   比如</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'>   <span class="o">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nl">newWithArticle:</span><span class="p">(</span><span class="n">Article</span> <span class="o">*</span><span class="p">)</span><span class="n">article</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>        <span class="n">CKComponent</span> <span class="o">*</span><span class="n">headerComponent</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="n">featured</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">headerComponent</span> <span class="o">=</span> <span class="p">[</span><span class="n">FeaturedArticleHeaderComponent</span> <span class="nl">newWithArticle:</span><span class="n">article</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">headerComponent</span> <span class="o">=</span> <span class="p">[</span><span class="n">RegularArticleHeaderComponent</span> <span class="nl">newWithArticle:</span><span class="n">article</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">UIEdgeInsets</span> <span class="n">insets</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">};</span>
</span><span class='line'>        <span class="n">CGFloat</span> <span class="n">imageSize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">iPad</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">insets</span> <span class="o">=</span> <span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">};</span>
</span><span class='line'>          <span class="n">imageSize</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="p">[</span><span class="n">super</span> <span class="nl">newWithComponent:</span>
</span><span class='line'>                <span class="p">[</span><span class="n">CKStackLayoutComponent</span>
</span><span class='line'>                 <span class="nl">newWithView:</span><span class="p">{}</span>
</span><span class='line'>                 <span class="nl">size:</span><span class="p">{}</span>
</span><span class='line'>                 <span class="nl">style:</span><span class="p">{}</span>
</span><span class='line'>                 <span class="nl">children:</span><span class="p">{</span>
</span><span class='line'>                   <span class="p">{</span><span class="n">headerComponent</span><span class="p">},</span>
</span><span class='line'>                   <span class="p">{[</span><span class="n">ArticleTextComponent</span>
</span><span class='line'>                     <span class="nl">newWithArticle:</span><span class="n">article</span>
</span><span class='line'>                     <span class="nl">insets:</span><span class="n">insets</span>
</span><span class='line'>                     <span class="nl">imageSize:</span><span class="n">imageSize</span><span class="p">]},</span>
</span><span class='line'>                 <span class="p">}]]</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<pre><code>如果分支过多，考虑把组件拆分到单独的小组件，再利用复合模式组装起立
</code></pre>

<p>5： Components 不能够被delegate引用</p>

<pre><code>Components 的生命周期都是短暂的，不是手动控制。 可选的是采用CKComponentController，CKComponentController生命持久的，他们持久化跟踪每个版本comonent 的更新。

比如下面的方式是不推荐的
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'>    <span class="err">@</span><span class="n">implementation</span> <span class="n">AlertDisplayComponent</span> <span class="o">&lt;</span><span class="n">UIAlertViewDelegate</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">UIAlertView</span> <span class="o">*</span><span class="n">_alertView</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didTapDisplayAlert</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">_alertView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="err">@</span><span class="s">&quot;Are you sure?&quot;</span>
</span><span class='line'>                                            <span class="nl">message:</span><span class="n">nil</span>
</span><span class='line'>                                           <span class="nl">delegate:</span><span class="n">self</span> <span class="p">...];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_alertView</span> <span class="n">show</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">alertView:</span><span class="p">(</span><span class="n">UIAlertView</span> <span class="o">*</span><span class="p">)</span><span class="n">alert</span> <span class="nl">didDismissWithButtonIndex:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">buttonIndex</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">updateState:</span><span class="p">...];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="err">@</span><span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>  因为上面的组件self 可能deallocate，所以alert的delegate为空，不是你想要的结果
   最佳方式</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'>   <span class="err">@</span><span class="n">interface</span> <span class="n">AlertDisplayComponentController</span> <span class="o">:</span> <span class="n">CKComponentController</span> <span class="o">&lt;</span><span class="n">UIAlertViewDelegate</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'>   <span class="err">@</span><span class="n">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="err">@</span><span class="n">implementation</span> <span class="n">AlertDisplayComponentController</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">UIAlertView</span> <span class="o">*</span><span class="n">_alertView</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didTapDisplayAlert</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_alertView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIAlertView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="err">@</span><span class="s">&quot;Are you sure?&quot;</span>
</span><span class='line'>                                            <span class="nl">message:</span><span class="n">nil</span>
</span><span class='line'>                                           <span class="nl">delegate:</span><span class="n">self</span> <span class="p">...];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">_alertView</span> <span class="n">show</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">alertView:</span><span class="p">(</span><span class="n">UIAlertView</span> <span class="o">*</span><span class="p">)</span><span class="n">alert</span> <span class="nl">didDismissWithButtonIndex:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">buttonIndex</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">component</span> <span class="nl">updateState:</span><span class="p">...];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="err">@</span><span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>6： 对象传递到组件应该不可变的</p>

<pre><code>因为+new 在后台线程创建，创建的组件在多线程操作，可变的对象mutable 是nonatomic,即便是atomic，还是存在race condition,会影响代码的逻辑
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ComponentKit 优势与劣势]]></title>
    <link href="http://www.davidyanggo.me/blog/2015/04/02/componentkit-you-shi-yu-lie-shi/"/>
    <updated>2015-04-02T21:49:41+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2015/04/02/componentkit-you-shi-yu-lie-shi</id>
    <content type="html"><![CDATA[<p>ComponentKit 突出的地方是在复杂的列表视图，在Facebook的News Feed IOS版本app得到了很好的体现</p>

<!--more-->


<p>优势：</p>

<p>  1：简单声明式：就像React 这个javascript库一样。</p>

<p>  2：滑动性能的提升：所有的布局操作都在后台线程操作，这样主线程不会太忙</p>

<p>  3；View回收重用，所有组件视图都是按照声明表达式方式来配置，使得view可以很好的自动回收重用</p>

<p>  4: 组件化：组件使得Compnentkit构建负责的UI，不会超过300行代码</p>

<p>注意点：</p>

<p>  1：UI接口不是list或者表格不适合ComponentKit</p>

<p>  2: ComponentKit 要求C++，Objective。 目前还没有Swift版本</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[移动端视频外挂字幕解决方案]]></title>
    <link href="http://www.davidyanggo.me/blog/2014/04/13/yi-dong-duan-shi-pin-wai-gua-zi-mu-jie-jue-fang-an/"/>
    <updated>2014-04-13T23:21:52+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2014/04/13/yi-dong-duan-shi-pin-wai-gua-zi-mu-jie-jue-fang-an</id>
    <content type="html"><![CDATA[<p>webvtt字幕文件已经很好的支持跨平台，特别是 html5的支持。 ios 6以后在这方面也已经无缝集成，底层做字幕渲染支持。</p>

<!--more-->


<p>首先说下外挂字幕的场景吧，有需求的地方才会有技术的跟进。 想必大家都看过美剧吧，视频运营商拿过来的很多已经内部集成了e文，那要翻译显示中文就是外挂字幕上场了，webvtt 技术就很好解决了这个问题。</p>

<p>有需求才有市场，下面就谈谈外挂字幕webvtt文件这么在视频里面集成。</p>

<p>1） 首先是说下在ios系统下字幕文件与视频播放文件的流程。 直接看流程图</p>

<p><img src="http://www.davidyanggo.me/images/vtt_1.png"></p>

<p>m3u8文件是为了多码率的适配而提出的，为了支持外挂字体，需要整合vtt与m3u8文件。整个合并步骤流程图如上，下面说下具体的步骤
2） 创建webvtt 外挂字幕（字幕拓展名为.vtt）</p>

<p>.vtt 文件可以像.ts文件一样，利用mediasubtitlesegmenter工具
拆成片段，每一个片段都是一个小的.vtt字幕文件，.vtt文件内容以及拆分的片段文件列表如下截图：</p>

<p><img src="http://www.davidyanggo.me/images/vtt_2.png"></p>

<p>上面是具体的.vtt 文件内容， 有起始时间，结束时间，显示相对位置</p>

<p><img src="http://www.davidyanggo.me/images/vtt_3.png"></p>

<p>3)建立一个.m3u8 字幕播放列表文件.</p>

<p>把上面拆分的字幕文件.vtt 的链接地址url放到.m3u8字幕播放列表文件里面，字幕url地址可以是绝对路径或者相对路径, 具体的内容如下截图：</p>

<p><img src="http://www.davidyanggo.me/images/vtt_4.png"></p>

<p>上面是字幕文件集合，也就是subtitle.m3u8 的文件内容</p>

<p>4)添加.m3u8 字幕文件播放列表地址到主.m3u8播放文件里面</p>

<p>主.m3u8文件内容主要包含字幕文件地址与ts文件地址，ts文件与字幕文件主要通过Group-ID,SUBTITLES 属性建立视频内容与文字对应关系，主.m3u8文件具体内容如下截图</p>

<p><img src="http://www.davidyanggo.me/images/vtt_5.png"></p>

<p>5)主.m3u8文件解释，主要介绍几个关键的属性</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#EXT-X-MEDIA:TYPE=SUBTITLES,GROUP-ID=&quot;subs&quot;,NAME=&quot;English&quot;,DEFAULT=YES,AUTOSELECT=YES,FORCED=NO,LANGUAGE=&quot;eng&quot;,URI=&quot;Subtitle.m3u8&quot; </span>
</span></code></pre></td></tr></table></div></figure>


<p>表示链接到字幕文件的相关属性设置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#EXT-X-MEDIA:TYPE=SUBTITLES 表示字幕文件标识 </span>
</span><span class='line'><span class="n">GROUP</span><span class="o">-</span><span class="n">ID</span><span class="o">=</span><span class="s">&quot;subs&quot;</span> <span class="err">表示字幕文件与</span><span class="n">ts</span><span class="err">文件对应的标识，</span>
</span><span class='line'><span class="n">DEFAULT</span><span class="o">=</span> <span class="n">YES</span>  <span class="err">表示视频播放默认的字幕文件</span>
</span><span class='line'><span class="n">LANGUAGE</span><span class="o">=</span><span class="s">&quot;eng&quot;</span> <span class="err">表示字幕语言</span><span class="p">,</span><span class="err">支持多语言字幕</span>
</span><span class='line'><span class="n">URI</span><span class="o">=</span><span class="s">&quot;Subtitle.m3u8  字幕的路径文件名</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=263851,CODECS=&quot;mp4a.40.2, avc1.4d400d&quot;,RESOLUTION=416x234,AUDIO=&quot;bipbop_audio&quot;,SUBTITLES=&quot;subs&quot; </span>
</span><span class='line'><span class="n">aaa</span><span class="p">.</span><span class="n">m3u8</span>
</span><span class='line'><span class="err">表示链接的</span><span class="n">ts</span><span class="err">文件相关属性设置</span>
</span><span class='line'><span class="n">SUBTITLES</span><span class="o">=</span><span class="s">&quot;subs&quot;</span>  <span class="err">链接到字幕文件，建立</span><span class="n">ts</span><span class="err">文件与字幕文件标识</span>
</span><span class='line'><span class="n">aaa</span><span class="p">.</span><span class="n">m3u8</span> <span class="err">里面都是对应的</span><span class="n">ts</span><span class="err">文件</span>
</span></code></pre></td></tr></table></div></figure>


<p>按照上面的流程建立好webvtt文件。之后就是视频客户端解析。</p>

<p>ios 端 vtt接口VTTSettingManager.h 的实现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="err">@</span><span class="n">interface</span> <span class="n">VTTSettingManager</span> <span class="o">:</span> <span class="n">NSObject</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">retain</span><span class="p">)</span> <span class="n">AVPlayer</span> <span class="o">*</span> <span class="n">player</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nl">initWithPlayer:</span><span class="p">(</span><span class="n">AVPlayer</span><span class="o">*</span><span class="p">)</span><span class="n">newPlayer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* ! vtt 字幕设置</span>
</span><span class='line'><span class="cm"> * @pram: entity 字幕实体类</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">setVttFontStyle:</span><span class="p">(</span><span class="n">VTTSettingEntity</span><span class="o">*</span><span class="p">)</span><span class="n">entity</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cm">/* ! 开启字幕</span>
</span><span class='line'><span class="cm"> *   如果影片有webvtt 设置才起作用</span>
</span><span class='line'><span class="cm"> *   返回true 有字幕,操作成功，false 影片没有字幕，操作失败</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="o">-</span><span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">enableVtt</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cm">/* ! 关闭字幕</span>
</span><span class='line'><span class="cm"> *   如果影片有webvtt 设置才起作用</span>
</span><span class='line'><span class="cm"> *   返回true 操作成功，false 操作失败</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="o">-</span><span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">disableVtt</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* ! 设置字幕语言(要设置的区域， vtt文件需要存在对于的区域语言 )</span>
</span><span class='line'><span class="cm"> * @pram: localeIdentifier 区域 如en_US</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="o">-</span><span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nl">setVTTLanguage:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">localeIdentifier</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * webvtt 字幕设置实体类</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/</span>
</span><span class='line'><span class="err">@</span><span class="n">interface</span> <span class="n">VTTSettingEntity</span> <span class="o">:</span> <span class="n">NSObject</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">retain</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span> <span class="n">fontFamilyName</span><span class="p">;</span>   <span class="c1">//(不传值，默认为空) 字体家族</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span> <span class="n">relativeSize</span><span class="p">;</span>          <span class="c1">//(不传值，默认是100) 字体相对大小 如：relativeSize ==120 表示字体大小为原来的120%</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">fr</span><span class="p">;</span>  <span class="c1">//The foreground color for text,representing r  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">fg</span><span class="p">;</span>  <span class="c1">//The foreground color for text,representing g  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">fb</span><span class="p">;</span>  <span class="c1">//The foreground color for text,representing b  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">fa</span><span class="p">;</span>  <span class="c1">//The foreground color for text,representing a  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span>  <span class="n">foregroundColorEnable</span><span class="p">;</span>    <span class="c1">// (fr,fg,fb,fa传了值，foregroundColorEnable设置为true，默认是false)foreground color enable;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">br</span><span class="p">;</span>  <span class="c1">//The background color for text,representing r  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">bg</span><span class="p">;</span>  <span class="c1">//The background color for text,representing g  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">bb</span><span class="p">;</span>  <span class="c1">//The background color for text,representing b  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>  <span class="n">ba</span><span class="p">;</span>  <span class="c1">//The background color for text,representing a  0.0-1.0</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span>  <span class="n">backgroundColorEnable</span><span class="p">;</span>    <span class="c1">//(br,bg,bb,ba传了值，backgroundColorEnable设置为true，默认是false) background color enable;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">boldStyle</span><span class="p">;</span>    <span class="c1">// (不传值，默认是false)设置粗体</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">italicStyle</span><span class="p">;</span>  <span class="c1">// (不传值，默认是false)设置斜体</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">assign</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">underlineStyle</span><span class="p">;</span>  <span class="c1">//(不传值，默认是false)设置下划线</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">retain</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span> <span class="n">cssName</span><span class="p">;</span>   <span class="c1">//(不传值，默认是空)css style name;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>参考文档</p>

<p><a href="http://en.wikipedia.org/wiki/HTTP_Live_Streaming">http://en.wikipedia.org/wiki/HTTP_Live_Streaming</a></p>

<p><a href="https://developer.apple.com/streaming">https://developer.apple.com/streaming</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cocos2dx中文显示]]></title>
    <link href="http://www.davidyanggo.me/blog/2014/04/13/cocos2dxzhong-wen-xian-shi/"/>
    <updated>2014-04-13T17:22:08+08:00</updated>
    <id>http://www.davidyanggo.me/blog/2014/04/13/cocos2dxzhong-wen-xian-shi</id>
    <content type="html"><![CDATA[<p>cocos2dx 里面的label 对中文显示的支持不是很友好，在windows 环境下，会出现乱码，这主要是编码的问题。
中文支持主要还是还是使用UTF8。 因此解决的方法就是转换成UTF8 .
方法如下： <!--more--></p>

<p>1）方法1：如果考虑做过多语言发布app的，就知道本地话问题。一般都是通过读取语言文件，因此可以通过读取UTF8格式的文件，把UI显示的内容保存到文件里面
这是一种解决方法</p>

<p>2）方法2：就是转换窄字符，宽字符</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">class</span>  <span class="nc">WStrToUTF8</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>     <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">StrToUTF8</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">curLocale</span><span class="o">=</span><span class="n">setlocale</span><span class="p">(</span><span class="n">LC_ALL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>          <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="n">src</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>          <span class="kt">wchar_t</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span><span class="k">new</span> <span class="kt">wchar_t</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
</span><span class='line'>          <span class="kt">int</span> <span class="n">total</span><span class="o">=</span><span class="n">mbstowcs</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">src</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">len</span><span class="p">);</span>
</span><span class='line'>          <span class="n">str</span><span class="p">[</span><span class="n">total</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>          <span class="n">std</span><span class="o">::</span><span class="n">wstring</span> <span class="n">wstr</span><span class="o">=</span><span class="n">str</span><span class="p">;</span>
</span><span class='line'>          <span class="k">delete</span><span class="p">[]</span> <span class="n">str</span><span class="p">;</span>
</span><span class='line'>          <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="n">curLocale</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">WStrToUTF8</span><span class="p">(</span><span class="n">wstr</span><span class="p">);</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">WStrToUTF8</span><span class="p">(</span> <span class="k">const</span> <span class="n">wstring</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">dest</span><span class="p">;</span>
</span><span class='line'>          <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">src</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>               <span class="kt">wchar_t</span> <span class="n">w</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>               <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="mh">0x7f</span><span class="p">)</span>
</span><span class='line'>                    <span class="n">dest</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="n">w</span><span class="p">);</span>
</span><span class='line'>               <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="mh">0x7ff</span><span class="p">){</span>
</span><span class='line'>                    <span class="n">dest</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mh">0xc0</span> <span class="o">|</span> <span class="p">((</span><span class="n">w</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span><span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">));</span>
</span><span class='line'>                    <span class="n">dest</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mh">0x80</span><span class="o">|</span> <span class="p">(</span><span class="n">w</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">));</span>
</span><span class='line'>               <span class="p">}</span>
</span><span class='line'>               <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;=</span> <span class="mh">0xffff</span><span class="p">){</span>
</span><span class='line'>                    <span class="n">dest</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mh">0xe0</span> <span class="o">|</span> <span class="p">((</span><span class="n">w</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span><span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">));</span>
</span><span class='line'>                    <span class="n">dest</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mh">0x80</span><span class="o">|</span> <span class="p">((</span><span class="n">w</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">));</span>
</span><span class='line'>                    <span class="n">dest</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mh">0x80</span><span class="o">|</span> <span class="p">(</span><span class="n">w</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">));</span>
</span><span class='line'>               <span class="p">}</span>
</span><span class='line'>               <span class="k">else</span>
</span><span class='line'>                    <span class="n">dest</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="sc">&#39;?&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">dest</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Demo 如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="n">LabelTTF</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">WStrToUTF8</span><span class="o">::</span><span class="n">StrToUTF8</span><span class="p">(</span><span class="s">&quot;大闹天宫3！&quot;</span><span class="p">),</span> <span class="s">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">LabelTTF</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">WStrToUTF8</span><span class="o">::</span><span class="n">WStrToUTF8</span><span class="p">(</span><span class="s">&quot;大闹天宫&quot;</span><span class="p">),</span> <span class="s">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
